 # API Configuration
  # Routes API requests from WebApp nginx to API container

  # API routes - all /api requests go to API service
  location /api/ {
      # Remove /api prefix and forward to API service
      rewrite ^/api/(.*) /$1 break;

      proxy_pass http://ollo-api:5000;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;

      # Timeouts
      proxy_connect_timeout 60s;
      proxy_send_timeout 60s;
      proxy_read_timeout 60s;
  }

  # Swagger documentation (local access only)
  location /swagger {
      # Only allow local/private network access
      allow 127.0.0.1;
      allow 10.0.0.0/8;
      allow 172.16.0.0/12;
      allow 192.168.0.0/16;
      deny all;

      proxy_pass http://ollo-api:5000/swagger;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_Set_header X-Forwarded-Proto $scheme;
  }

  # API Health check
  location /api/health {
      proxy_pass http://ollo-api:5000/health;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_Set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_Set_header X-Forwarded-Proto $scheme;
      access_log off;
  }